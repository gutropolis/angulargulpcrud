var app=angular.module("libApp",[]);app.controller("libCntrl",function($scope,$timeout,$http){$scope.book_name="",$scope.author_name="",$scope.department_name="",$scope.in_stock="yes",$scope.listbook=!1,$scope.addbook=!0,$scope.editBook=!1,$scope.bookList=[],$scope.edit_book_name="",$scope.edit_author_name="",$scope.edit_department_name="",$scope.edit_in_stock="",$scope.update_bookId="",$scope.bookDetail=[],$scope.makeFieldValid=function(arg){"book_name"==arg?""!=$scope.book_name.length&&$("#book_name").css("border",""):"author_name"==arg?""!=$scope.author_name.length&&$("#author_name").css("border",""):"department_name"==arg?""!=$scope.department_name.length&&$("#department_name").css("border",""):"edit_book_name"==arg?""!=$scope.edit_book_name.length&&$("#edit_book_name").css("border",""):"edit_author_name"==arg?""!=$scope.edit_author_name.length&&$("#edit_author_name").css("border",""):"edit_department_name"==arg&&""!=$scope.edit_department_name.length&&$("#edit_department_name").css("border","")},$scope.add_book=function(){if(""==$scope.book_name.length)$("#book_name").css("border","2px solid red"),$("#book_name").focus();else if(""==$scope.author_name.length)$("#author_name").css("border","2px solid red"),$("#author_name").focus();else if(""==$scope.department_name.length)$("#department_name").css("border","2px solid red"),$("#department_name").focus();else{var bookData=$("#admin_panel_lib").serializeArray(),addUrl=$("#add_cntrl").val();$.ajax({type:"POST",url:addUrl,dataType:"json",data:bookData,success:function(data){1==data.R?($("#msg").html("<b style='color:green;'>"+data.M+"</b>"),$timeout(function(){$("#msg").html("")},3e3)):($("#msg").html("<b style='color:red;'>"+data.M+"</b>"),$timeout(function(){$("#msg").html("")},3e3))}})}},$scope.list_of_books=function(){$scope.listbook=!0,$scope.addbook=!1,$scope.editBook=!1;var viewUrl="../angularcrud/view-controller.php";$http.get(viewUrl).success(function(data){$scope.bookList=[],$.each(data,function(index,value){$scope.bookList.push({id:value.book_id,book:value.book_name,author:value.author_name,dept:value.department,stock:value.in_stock})})})},$scope.remove_book=function(book){var r=confirm("Are you sure want to delete this book?"),dltUrl="../library/delete-controller.php";1==r&&$http({method:"post",url:dltUrl,dataType:"json",data:$.param({id:book.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){if(1==data.R){alert(data.M);var index=$scope.bookList.indexOf(book);$scope.bookList.splice(index,1)}})},$scope.edit_book=function(book){$scope.editBook=!0,$scope.listbook=!1,$scope.bookDetail={},$scope.bookDetail={name:book.book,author:book.author,dept:book.dept,stock:book.stock,bookid:book.id},$scope.edit_book_name=$scope.bookDetail.name,$scope.edit_author_name=$scope.bookDetail.author,$scope.edit_department_name=$scope.bookDetail.dept,$scope.edit_in_stock=$scope.bookDetail.stock,$scope.update_bookId=$scope.bookDetail.bookid},$scope.update_book=function(){if(""==$scope.edit_book_name.length)$("#edit_book_name").css("border","2px solid red"),$("#edit_book_name").focus();else if(""==$scope.edit_author_name.length)$("#edit_author_name").css("border","2px solid red"),$("#edit_author_name").focus();else if(""==$scope.edit_department_name.length)$("#edit_department_name").css("border","2px solid red"),$("#edit_department_name").focus();else{var updtUrl=$("#edit_cntrl").val();$("#edit_panel_lib").serializeArray();$http({method:"post",url:updtUrl,dataType:"json",data:"book_name="+$scope.edit_book_name+"&author="+$scope.edit_author_name+"&dept="+$scope.edit_department_name+"&stock="+$scope.edit_in_stock+"&id="+$scope.update_bookId,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){1==data.R?($("#upmsg").html("<b style='color:green;'>"+data.M+"</b>"),$timeout(function(){$("#upmsg").html("")},3e3)):($("#upmsg").html("<b style='color:red;'>"+data.M+"</b>"),$timeout(function(){$("#upmsg").html("")},3e3))})}}});